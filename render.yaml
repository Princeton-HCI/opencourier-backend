services:
  - name: opencourier-backend
    type: web
    runtime: node
    plan: free
    env: node
    branch: main
    buildCommand: |
      yarn install --frozen-lockfile --production=false
      yarn prisma:generate
      yarn build
      mkdir -p dist/prisma && cp -r prisma/client dist/prisma/client
    startCommand: yarn start:prod
    envVars:
      - key: PORT
        value: 10000
      - key: NODE_ENV
        value: production
      - key: NODE_VERSION
        value: 20.x
      - key: DB_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      - key: JWT_EXPIRATION
        value: '3153600000'
      - key: JWT_REFRESH_SECRET_KEY
        sync: false
      - key: JWT_REFRESH_EXPIRATION
        value: '3153600000'
      - key: PUBLIC_API_URL
        sync: false
      - key: ADMIN_URL
        sync: false
      - key: SENTRY_DSN
        sync: false
      - key: OPENCOURIER_ENV
        value: production
      - key: WEBSOCKET_DISPATCHER
        value: socketio
    healthCheckPath: /health
